<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started · MessyTimeSeries.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="MessyTimeSeries.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MessyTimeSeries.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">MessyTimeSeries.jl</a></li><li class="is-active"><a class="tocitem" href>Getting started</a><ul class="internal"><li><a class="tocitem" href="#Centred-moving-averages"><span>Centred moving averages</span></a></li><li><a class="tocitem" href="#Two-sided-interpolation"><span>Two-sided interpolation</span></a></li><li><a class="tocitem" href="#Optimal-filtering-and-smoothing"><span>Optimal filtering and smoothing</span></a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../kalman/">Kalman filter and smoother</a></li><li><a class="tocitem" href="../subsampling/">Subsampling</a></li></ul></li><li><span class="tocitem">Appendix</span><ul><li><a class="tocitem" href="../methods/">Annex functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/fipelle/MessyTimeSeries.jl/blob/master/docs/src/man/getting_started.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h1><p>This page contains a few examples to get started with <code>MessyTimeSeries</code>. These examples are based on economic data from <a href="https://fred.stlouisfed.org/">FRED</a>, downloaded via <code>FredData</code>. Make sure that your FRED API is accessible to <code>FredData</code> (see <a href="https://github.com/micahjsmith/FredData.jl">here</a>).</p><p>Before getting into the examples, please run the following snippet:</p><pre><code class="language- hljs"># Load packages
using Dates, DataFrames, LinearAlgebra, Optim, Plots, Measures, StableRNGs;
using FredData: Fred, get_data;
using MessyTimeSeries;

# Initialise FredData
f = Fred();

# Download seasonal adjusted (SA) industrial production (IP)
dates = get_data(f, &quot;INDPRO&quot;, observation_start=&quot;1984-01-01&quot;, units=&quot;lin&quot;).data[!, :date];
sa_ip = get_data(f, &quot;INDPRO&quot;, observation_start=&quot;1984-01-01&quot;, units=&quot;lin&quot;).data[!, :value];

# Download not seasonally adjusted (NSA) industrial production (IP)
nsa_ip = get_data(f, &quot;IPB50001N&quot;, observation_start=&quot;1984-01-01&quot;, units=&quot;lin&quot;).data[:, :value];

# Set random seed
rng = StableRNG(1);</code></pre><div class="admonition is-info"><header class="admonition-header">Advanced estimation and validation algorithms</header><div class="admonition-body"><p>Advanced estimation and validation algorithms are not included in this package, but in <a href="https://github.com/fipelle/MessyTimeSeriesOptim.jl"><code>MessyTimeSeriesOptim</code></a>.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Please note that this tutorial evaluates the following sections in the order reported below.</p></div></div><h2 id="Centred-moving-averages"><a class="docs-heading-anchor" href="#Centred-moving-averages">Centred moving averages</a><a id="Centred-moving-averages-1"></a><a class="docs-heading-anchor-permalink" href="#Centred-moving-averages" title="Permalink"></a></h2><p>Centred moving averages have numerous purposes in time series analysis. <code>MessyTimeSeries</code> has a simple implementation for it. Suppose, for instance, that you are interested in computing the centred moving average of NSA Industrial Production to reduce the effect of seasonality. This can be done running:</p><pre><code class="language- hljs">nsa_ip_cma = centred_moving_average(permutedims(nsa_ip), 13);
nothing # hide</code></pre><p>The size of <code>nsa_ip_cma</code> is identical to the one of the original data, but includes <code>6</code> leading and trailing missing observations, since the window is set to 13. The results can be inspected graphically via</p><pre><code class="language- hljs">fig = plot(dates, nsa_ip[:], label=&quot;Industrial production (NSA)&quot;, legend=:topleft, ylims=(Inf, 120))
plot!(fig, dates, nsa_ip_cma[:], label=&quot;Industrial production (NSA, CMA)&quot;, ylims=(Inf, 120));</code></pre><h2 id="Two-sided-interpolation"><a class="docs-heading-anchor" href="#Two-sided-interpolation">Two-sided interpolation</a><a id="Two-sided-interpolation-1"></a><a class="docs-heading-anchor-permalink" href="#Two-sided-interpolation" title="Permalink"></a></h2><p><code>MessyTimeSeries</code> provides two simplified interfaces for interpolating time-series data. More advanced interpolations can be implemented via the state-space modelling functions described in the next section.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The following examples remove about 50% of the observed data to produce more evident interpolations graphically.</p></div></div><h3 id="Mean-reverting-data"><a class="docs-heading-anchor" href="#Mean-reverting-data">Mean-reverting data</a><a id="Mean-reverting-data-1"></a><a class="docs-heading-anchor-permalink" href="#Mean-reverting-data" title="Permalink"></a></h3><p>Compute the month-on-month (%) changes of industrial production and input a number of missing observations via</p><pre><code class="language- hljs"># Compute MoM (%) data
sa_ip_mom = 100*(sa_ip[2:end]./sa_ip[1:end-1] .- 1);

# Populate `missings_coordinates`
missings_coordinates = unique(rand(rng, 1:length(sa_ip_mom), 300));

# Input missing observations
sa_ip_mom_incomplete = permutedims(sa_ip_mom) |&gt; JMatrix{Float64};
sa_ip_mom_incomplete[1, missings_coordinates] .= missing;
nothing # hide</code></pre><p>The function <code>interpolate_series</code> replaces the missing observations with the average of the observed values. Results can be inspected graphically as follows:</p><pre><code class="language- hljs"># Interpolate
sa_ip_mom_interpolated = interpolate_series(sa_ip_mom_incomplete);

# Plots
fig = plot(dates[2:end], sa_ip_mom, label=&quot;Industrial production (SA, MoM%)&quot;, legend=:topleft, ylims=(-16, 8));
plot!(fig, dates[2:end], permutedims(sa_ip_mom_interpolated), label=&quot;Industrial production (SA, MoM%, interpolated)&quot;, legend=:topleft, ylims=(-16, 8));</code></pre><h3 id="Non-stationary-data"><a class="docs-heading-anchor" href="#Non-stationary-data">Non-stationary data</a><a id="Non-stationary-data-1"></a><a class="docs-heading-anchor-permalink" href="#Non-stationary-data" title="Permalink"></a></h3><p>Input a number of missing observations to the SA industrial production index via</p><pre><code class="language- hljs">sa_ip_incomplete = permutedims(sa_ip) |&gt; JMatrix{Float64};
sa_ip_incomplete[1, missings_coordinates] .= missing;
nothing # hide</code></pre><p>The function <code>forward_backwards_rw_interpolation</code> interpolates <code>sa_ip_incomplete</code> using a random walk logic both forward and backwards in time. Results can be inspected graphically as follows:</p><pre><code class="language- hljs"># Interpolate
sa_ip_interpolated = forward_backwards_rw_interpolation(sa_ip_incomplete);

# Plots
fig = plot(dates, sa_ip, label=&quot;Industrial production (SA)&quot;, legend=:topleft, ylims=(Inf, 120));
plot!(fig, dates, permutedims(sa_ip_interpolated), label=&quot;Industrial production (SA, interpolated)&quot;, legend=:topleft, ylims=(Inf, 120));</code></pre><h2 id="Optimal-filtering-and-smoothing"><a class="docs-heading-anchor" href="#Optimal-filtering-and-smoothing">Optimal filtering and smoothing</a><a id="Optimal-filtering-and-smoothing-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-filtering-and-smoothing" title="Permalink"></a></h2><p>A large chunk of this package focusses on optimal filtering and smoothing problems (Anderson and Moore, 2012). This is an elegant way to model time series that show irregularities such as missing observations with applications ranging from real-time forecasting to structural decompositions (see, for instance, Durbin and Koopman, 2012).  </p><p>In this short tutorial, I have illustrated a simple way to seasonal adjust non-stationary time series. This should be enough to get the handle of the basic tools included in this package.</p><div class="admonition is-info"><header class="admonition-header">Advanced state-space models</header><div class="admonition-body"><p>Advanced state-space models can be easily processed through the functions described below. However, estimating them is often hard, especially with incomplete data. Specialised methods for these problems are implemented in <a href="https://github.com/fipelle/MessyTimeSeriesOptim.jl"><code>MessyTimeSeriesOptim</code></a>.</p></div></div><h3 id="Seasonal-adjustments"><a class="docs-heading-anchor" href="#Seasonal-adjustments">Seasonal adjustments</a><a id="Seasonal-adjustments-1"></a><a class="docs-heading-anchor-permalink" href="#Seasonal-adjustments" title="Permalink"></a></h3><h4 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h4><p>Suppose that you would like to seasonally adjust the NSA Industrial Production index. One way to do it is writing a state-space model comprising a trend (<span>$\mu_{t}$</span>) and a latent component identifying the seasonal factor (<span>$\gamma_{t}$</span>):</p><p class="math-container">\[\begin{alignat*}{2}
    Y_{t}      &amp;= \mu_{t} + \gamma_{t}, \\
    \mu_{t}    &amp;= \beta_{t-1} + \mu_{t-1} + u_{t}, \qquad &amp;&amp;u_{t} \sim N(0, \sigma_{u}^2), \\
    \beta_{t}  &amp;= \beta_{t-1} + v_{t}, \qquad &amp;&amp;v_{t} \sim N(0, \sigma_{v}^2), \\
    \gamma_{t} &amp;= \sum_{j=1}^{s/2} \gamma_{j,t},
\end{alignat*}\]</p><p>where</p><p class="math-container">\[\begin{alignat*}{2}
    \left( \begin{array}{c} \gamma_{j,t} \\ \gamma_{j,t}^{*} \end{array} \right) = \left( \begin{array}{cc} \cos \lambda_j &amp; \sin \lambda_j \\ -\sin \lambda_j &amp; \cos \lambda_j \end{array} \right) \left( \begin{array}{c} \gamma_{j,t-1} \\ \gamma_{j,t-1}^{*} \end{array} \right) + \left( \begin{array}{c} w_{j,t} \\ w_{j,t}^{*} \end{array} \right), \qquad \left( \begin{array}{c} w_{j,t} \\ w_{j,t}^{*} \end{array} \right) \sim N(0, \sigma_{w}^2 I),
\end{alignat*}\]</p><p><span>$\lambda_{j} = 2 \pi j/s$</span>, <span>$s=12$</span>, <span>$j=1, \ldots, s/2$</span> and <span>$t=1, \ldots, T$</span>.</p><h4 id="Estimation"><a class="docs-heading-anchor" href="#Estimation">Estimation</a><a id="Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Estimation" title="Permalink"></a></h4><p>Note that this model can be written in the compact form</p><p class="math-container">\[\begin{alignat*}{2}
    Y_{t} &amp;= B*X_{t} + e_{t} \\
    X_{t} &amp;= C*X_{t-1} + U_{t}
\end{alignat*}\]</p><p>where <span>$e_{t} \sim N(0, 10^{-4})$</span> and <span>$U_{t} \sim N(0, Q)$</span> building the coefficients via</p><pre><code class="language-julia hljs"># Convenient function for B
build_B(s::Int64) = hcat([[1.0 0.0] for i=1:1+fld(s,2)]...);

# Convenient functions for C
build_C_gamma_j(λj::Float64) = [cos(λj) sin(λj); -sin(λj) cos(λj)];
build_C_gamma(s::Int64) = cat(dims=[1,2], [build_C_gamma_j(2*pi*j/s) for j=1:fld(s,2)]...);
build_C(s::Int64) = cat(dims=[1,2], [1 1; 0 1], build_C_gamma(s));

# Convenient functions for Q
build_Q_mu_beta(var_mu::Float64, var_beta::Float64) = Diagonal([var_mu, var_beta]) |&gt; Array;
build_Q_gamma(var_gamma::Float64, s::Int64) = Diagonal(kron(var_gamma*ones(fld(s,2)), [1;0])) |&gt; Array;
build_Q(var_mu::Float64, var_beta::Float64, var_gamma::Float64, s::Int64) = cat(dims=[1,2], build_Q_mu_beta(var_mu, var_beta), build_Q_gamma(var_gamma, s));</code></pre><p>The first thing to do for estimating the model using <code>Optim</code> is to define a relevant objective function to minimise. In this tutorial, I have build on the Kalman filter output to perform MLE:</p><pre><code class="language- hljs">function fmin(Y::Matrix{Float64}, vec_log_sigma::FloatVector)
    B = build_B(12);
    C = build_C(12);
    R = Symmetric(10^-4*ones(1,1));
    D = 1.0*Matrix(I, size(B,2), size(B,2));
    Q = Symmetric(build_Q(exp.(vec_log_sigma)..., 12));

    # Initial conditions
    X0 = zeros(size(B,2));
    P0 = Symmetric(1000.0*Matrix(I, size(B,2), size(B,2))); # diffuse initialisation

    # Run Kalman filter and return log-likelihood
    settings = KalmanSettings(Y, B, R, C, D, Q, X0, P0);
    status = kfilter_full_sample(settings);
    return -status.loglik;
end
nothing # hide</code></pre><div class="admonition is-info"><header class="admonition-header">Free parameters</header><div class="admonition-body"><p>In this simple model, the only free parameters are the variances of the trend, drift and seasonal components in the matrix <code>Q</code>.</p></div></div><p>Next, you need to run an appropriate <code>Optim</code> minimisation algorithm, such as:</p><pre><code class="language- hljs">optim_res = optimize(vec_sigma-&gt;fmin(permutedims(nsa_ip), vec_sigma), log(0.1)*ones(3), SimulatedAnnealing()); # arbitrary small variances to initialise the model
optim_res.minimizer, optim_res.minimum</code></pre><p>The optimal model configuration found by <code>Optim</code> is such that:</p><pre><code class="language- hljs">B = build_B(12);
C = build_C(12);
R = Symmetric(10^-4*ones(1,1));
D = 1.0*Matrix(I, size(B,2), size(B,2));
Q = Symmetric(build_Q(exp.(optim_res.minimizer)..., 12));

# Initial conditions
X0 = zeros(size(B,2));
P0 = Symmetric(1000.0*Matrix(I, size(B,2), size(B,2))); # diffuse initialisation

# Run Kalman filter and smoother
settings = KalmanSettings(permutedims(nsa_ip), B, R, C, D, Q, X0, P0);
status = kfilter_full_sample(settings);
history_X, history_P, X0, P0 = ksmoother(settings, status);
nothing # hide</code></pre><pre><code class="language- hljs">p1 = plot(dates, nsa_ip, label=&quot;Industrial production (NSA)&quot;, legend=:topleft, ylims=(Inf, 120));
plot!(p1, dates, hcat(history_X...)[1,:], label=&quot;Industrial production trend&quot;, legend=:topleft, ylims=(Inf, 120));</code></pre><pre><code class="language- hljs">seasonality = sum(hcat(history_X...)[3:end,:], dims=1);
p2 = plot(dates, permutedims(seasonality), label=&quot;Industrial production seasonality&quot;, legend=:topleft, ylims=(-6, 6))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« MessyTimeSeries.jl</a><a class="docs-footer-nextpage" href="../kalman/">Kalman filter and smoother »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.14 on <span class="colophon-date" title="Tuesday 15 March 2022 16:34">Tuesday 15 March 2022</span>. Using Julia version 1.6.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
